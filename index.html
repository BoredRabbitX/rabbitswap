<script>
    // COSTANTI AGGIORNATE
    const HOP_ADDR = "0xFf7FBB044170C855527735F08443A3e74C9E5580";
    const SWAP_ADDR = "0xc9af70a2cf987a19d3b5d0f7056a516bc8d9ed69";
    
    // ABI AGGIORNATA: Assicurati che il nome funzione sia identico a quello su Remix
    const HOP_ABI = [
        "function claimToken() external", // Controlla se si chiama claim() o claimToken()
        "function lastClaim(address) view returns (uint256)",
        "function balanceOf(address) view returns (uint256)",
        "function approve(address,uint256) returns (bool)"
    ];

    // ... (Logica di connessione precedente) ...

    async function claim() {
        try {
            updateStatus("PREPARAZIONE_TRANSAZIONE...");
            const btn = document.getElementById('btn-claim');
            btn.disabled = true;

            // FIX: Molte reti testnet richiedono gasPrice esplicito o gasLimit alto
            const tx = await hopContract.claimToken({ 
                gasLimit: 1000000 
            });

            updateStatus("MINING_IN_CORSO (PASEO)...");
            await tx.wait();

            updateStatus("CLAIM_RIUSCITO! +1 HOPx");
            await updateBalances();
            setTimeout(() => location.reload(), 3000);

        } catch (e) {
            console.error(e);
            btn.disabled = false;
            // Gestione errori specifica
            if (e.code === 4001) {
                updateStatus("UTENTE_HA_RIFIUTATO");
            } else {
                updateStatus("ERRORE: VERIFICA_GAS_O_COOLDOWN");
            }
        }
    }
</script>
